# 노션 자동화 프로젝트 개발 기록 (2026-01-19)

## 프로젝트 개요
Claude Code CLI에서 마크다운 파일을 노션 데이터베이스에 자동으로 업로드하는 자동화 시스템

## 주요 파일 구조
```
d:\son\notion-automation\
├── .env                 # API 키 및 데이터베이스 ID 설정
├── notion_helper.py     # 노션 API 클라이언트 (핵심)
├── add_to_notion.py     # 메인 실행 스크립트
├── quick_add.py         # 빠른 추가 스크립트
├── test_connection.py   # 연결 테스트 스크립트
└── notion-add.bat       # Windows 배치 파일
```

## 해결한 문제들

### 1. ImportError - 파일명 충돌
**문제**: `cannot import 'Client' from 'notion_client'`
**원인**: 로컬 파일명 `notion_client.py`가 라이브러리 `notion-client`와 충돌
**해결**: 파일명을 `notion_helper.py`로 변경, 클래스명도 `NotionHelper`로 변경

### 2. 속성명 불일치
**문제**: `"제목 is not a property that exists"`
**원인**: 코드의 속성명과 실제 노션 DB 속성명 불일치
**해결**: 속성명 매핑 수정
- `제목` → `이름`
- `상태` (select → status 타입으로)
- `카테고리` → `선택`
- `태그` → `다중 선택`

### 3. 언어 미지원 오류
**문제**: `"language should be ... instead was 'mgt'"`
**원인**: mgt 형식이 노션에서 지원하지 않는 언어
**해결**: `_map_language()` 함수에 지원 언어 목록 추가, 미지원 언어는 `plain text`로 자동 변환

### 4. 상태 옵션 오류
**문제**: `"Invalid status option. Status option '진행중' does not exist"`
**원인**: DB에 해당 상태 옵션이 없음
**해결**: status를 선택사항(Optional)으로 변경, 기본값 제거

## 추가된 기능들

### 마크다운 지원 기능
1. **헤딩** (`#`, `##`, `###`)
2. **리스트** (`-`, `*`, `1.`)
3. **코드 블록** (` ``` `)
4. **테이블** (`| 헤더 | 헤더 |`)
5. **인라인 서식**
   - `**굵게**`
   - `*기울임*`
   - `` `인라인 코드` ``
   - `~~취소선~~`

## 사용법

### 방법 1: 대화형 모드
```bash
python add_to_notion.py
```

### 방법 2: 인라인 모드
```bash
python add_to_notion.py --inline "제목" "내용"
```

### 방법 3: 파일 모드
```bash
python add_to_notion.py --file 파일.md
```

### 방법 4: 빠른 추가
```bash
python quick_add.py "제목" "내용"
python quick_add.py --file 파일.md
```

## 환경 설정 (.env)
```
NOTION_API_KEY=your_api_key_here
NOTION_DATABASE_ID=your_database_id_here
```

## 노션 데이터베이스 속성 구조
| 속성명 | 타입 | 필수 |
|--------|------|------|
| 이름 | title | O |
| 날짜 | date | O (자동) |
| 상태 | status | X |
| 선택 | select | X |
| 다중 선택 | multi_select | X |

## 미완료 작업
- MCP 서버를 통한 완전 자동화 (npm 설치 필요)
  - Claude Code에서 직접 명령어로 노션 업로드 가능하게 하려면 MCP 서버 설정 필요
  - Node.js/npm 설치 후 진행 가능

## 핵심 코드 (notion_helper.py)

```python
class NotionHelper:
    def create_page(self, title, content, category=None, tags=None, status=None)
    def _parse_content_to_blocks(self, content)  # 마크다운 → 노션 블록
    def _parse_rich_text(self, text)             # 인라인 서식 처리
    def _create_table_block(self, rows)          # 테이블 생성
    def _map_language(self, lang)                # 언어 매핑
```

## 참고
- 노션 API 키 발급: https://www.notion.so/my-integrations
- 데이터베이스 ID: 노션 URL에서 `{workspace}/{database_id}?v=...` 부분
